<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Start.gg Data Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="/style/mermaid.css" rel="stylesheet" />
  </head>
  <body class="p-8 flex flex-col gap-8 bg-slate-400">
    <div>
      <h1 class="text-4xl font-bold">Start.gg Data Viewer</h1>
    </div>
    <div>
      <h2 class="text-2xl font-bold">Videogames</h2>
      <div id="videogames-wrapper"></div>
    </div>
    <div>
      <h2 class="text-2xl font-bold">Characters</h2>
      <div id="characters-wrapper"></div>
    </div>
  </body>
  <script type="module">
    import { Grid, html } from 'https://unpkg.com/gridjs?module';

    let videogames = await (await fetch('./data/videogames.json')).json();
    let characters = await (await fetch('./data/characters.json')).json();

    characters = characters.map((character) => {
      const videogameMatch = videogames.filter((videogame) => videogame.id === character.videogameId);
      character.videogameName = videogameMatch[0] && videogameMatch[0].name ? videogameMatch[0].name : undefined;
      delete character.videogameId;
      return character;
    }).filter(character => character.videogameName)

    function extractPropertyValues(objects, propertyNames) {
      return objects.map((obj) => {
        const values = [];
        propertyNames.forEach((prop) => {
          values.push(obj[prop]);
        });
        return values;
      });
    }

    const gridConfig = {
      search: true,
      sort: true,
      autoWidth: false,
      className: {
        tbody: 'bg-slate-200',
        th: 'bg-slate-100',
        search: 'bg-slate-100',
        paginationButton: 'bg-slate-100',
        paginationButtonNext: 'bg-slate-100',
        paginationButtonCurrent: 'bg-slate-100',
        paginationButtonPrev: 'bg-slate-100',
      },
      pagination: {
        limit: 8,
      },
    }

    const videogameHeaders = [
      {name: 'id', width: '100px'},
      {name: 'abbrev'},
      {name: 'name'},
    ];

    const characterHeaders = [
      {name: 'id', width: '100px'},
      {name: 'name'},
      {name: 'videogameName'},
    ];

    new Grid({
      columns: videogameHeaders,
      data: extractPropertyValues(videogames, videogameHeaders.map(header => header.name)),
      ...gridConfig
    }).render(document.getElementById('videogames-wrapper'));

    new Grid({
      columns: characterHeaders,
      data: extractPropertyValues(characters, characterHeaders.map(header => header.name)),
      ...gridConfig
    }).render(document.getElementById('characters-wrapper'));
  </script>
</html>
